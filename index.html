<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hokkaido Synchro v8.4</title>
    <link rel="icon" href="https://i.postimg.cc/B6w5mWry/Design-sem-nome-3.png" type="image/png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'primary-blue': '#0077C2',
              'text-dark': '#1F2937',
              'background-light': '#F9FAFB',
              'accent-1': '#4F46E5',
              'accent-2': '#10B981',
              'status-success': '#16A34A',
              'status-warning': '#F59E0B',
              'status-error': '#DC2626',
            }
          }
        }
      }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase App (a versão principal do SDK) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body class="bg-background-light text-text-dark antialiased">

    <div class="flex h-screen bg-background-light">
        <!-- Sidebar de Navegação -->
        <aside id="sidebar" class="w-64 bg-white flex-col no-print border-r border-gray-200 fixed inset-y-0 left-0 z-30 transform -translate-x-full transition-transform duration-300 md:relative md:translate-x-0 md:flex">
            <div class="h-16 flex items-center justify-center border-b border-gray-200 px-4 relative">
                <img src="https://i.postimg.cc/5jdHwhF9/hokkaido-logo-110.png" alt="Logo Hokkaido Plastics" class="h-10">
                <button id="sidebar-close-btn" class="absolute top-1/2 -translate-y-1/2 right-4 p-2 md:hidden">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-2">
                <a href="#" class="nav-btn active" data-page="planejamento">
                    <i data-lucide="clipboard-list"></i><span>Planejamento</span>
                </a>
                <a href="#" class="nav-btn" data-page="lancamento">
                    <i data-lucide="keyboard"></i><span>Lançamento</span>
                </a>
                <a href="#" class="nav-btn" data-page="melhoria">
                    <i data-lucide="siren"></i><span>Melhoria Contínua</span>
                </a>
                <a href="#" class="nav-btn" data-page="parada">
                    <i data-lucide="wrench"></i><span>Parada de Máquina</span>
                </a>
                <a href="#" class="nav-btn" data-page="analise">
                    <i data-lucide="area-chart"></i><span>Análise</span>
                </a>
            </nav>
        </aside>

        <!-- Conteúdo Principal -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-white border-b border-gray-200 p-4 flex items-center justify-between no-print h-16">
                 <div class="flex items-center">
                    <button id="sidebar-open-btn" class="p-1 text-gray-600 hover:text-text-dark md:hidden">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    <h2 id="page-title" class="text-xl font-semibold text-text-dark ml-2">Planejamento</h2>
                 </div>
                 <img src="https://i.postimg.cc/wMZh3m85/Gemini-Generated-Image-gdpgb8gdpgb8gdpg-removebg-preview.png" alt="Logo Hokkaido Synchro" class="h-10">
            </header>

            <div class="flex-1 overflow-y-auto p-2 sm:p-6">
                <!-- PÁGINA: Planejamento -->
                <div id="planejamento-page" class="page-content space-y-6">
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg border-t-4 border-accent-1">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i data-lucide="clipboard-list" class="text-accent-1"></i>Planejar Produção do Dia</h2>
                        <form id="planning-form" class="space-y-5 pt-4">
                            <div><label for="planning-date-selector" class="block text-sm font-medium text-gray-700">Data do Planejamento</label><input type="date" id="planning-date-selector" name="date" required class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></div>
                            <div><label for="planning-machine" class="block text-sm font-medium text-gray-700">Máquina</label><select id="planning-machine" name="machine" required class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></select></div>
                            <div><label for="planning-client" class="block text-sm font-medium text-gray-700">Cliente</label><select id="planning-client" name="client" required class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></select></div>
                            <div><label for="planning-product" class="block text-sm font-medium text-gray-700">Produto</label><select id="planning-product" name="product" required class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm" disabled><option value="">Selecione um cliente</option></select></div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><label for="budgeted-cycle" class="block text-sm font-medium">Ciclo Padrão (s)</label><input type="number" id="budgeted-cycle" name="budgeted_cycle" required class="mt-1 w-full p-2 border-gray-300 rounded-md bg-gray-50" readonly></div>
                                <div><label for="mold-cavities" class="block text-sm font-medium">Cav. Padrão</label><input type="number" id="mold-cavities" name="mold_cavities" required class="mt-1 w-full p-2 border-gray-300 rounded-md bg-gray-50" readonly></div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div><label for="piece-weight" class="block text-sm font-medium">Peso Peça (g)</label><input type="number" id="piece-weight" name="piece_weight" required step="0.01" class="mt-1 w-full p-2 border-gray-300 rounded-md"></div>
                                <div><label for="box-weight" class="block text-sm font-medium">Peso Caixa (kg)</label><input type="number" id="box-weight" name="box_weight" value="0" step="0.01" class="mt-1 w-full p-2 border-gray-300 rounded-md"></div>
                                <div><label for="box-quantity-standard" class="block text-sm font-medium">Peças por Caixa</label><input type="number" id="box-quantity-standard" name="box_quantity_standard" required value="0" step="1" class="mt-1 w-full p-2 border-gray-300 rounded-md"></div>
                            </div>
                            <div><label for="planned-quantity" class="block text-sm font-medium">Qtd. Planejada (85% Efic.)</label><input type="number" id="planned-quantity" name="planned_quantity" required class="mt-1 w-full p-2 border-gray-300 rounded-md bg-gray-50" readonly></div>
                            <button type="submit" id="planning-submit-button" class="w-full bg-primary-blue hover:bg-blue-800 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2"><i data-lucide="plus-circle"></i><span>Adicionar ao Plano</span></button>
                            <div id="planning-status-message" class="text-sm font-semibold h-5 text-center"></div>
                        </form>
                    </div>
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i data-lucide="sliders-horizontal" class="text-accent-2"></i>Painel de Lançamento Ciclo/Cavidades</h2>
                        <div id="leader-launch-panel" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pt-4"></div>
                        <div id="leader-panel-loading" class="text-center py-10" style="display: none;"><i data-lucide="loader-2" class="w-12 h-12 animate-spin text-primary-blue mx-auto"></i></div>
                        <div id="leader-panel-no-data" class="text-center py-10 text-gray-500" style="display: none;"><p>Nenhum item planejado para a data selecionada.</p></div>
                    </div>
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i data-lucide="list-checks" class="text-gray-600"></i>Controle de Ciclo/Cavidade</h2>
                        <div class="overflow-x-auto pt-4">
                            <table class="min-w-full divide-y divide-gray-200 border">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th rowspan="2" class="px-2 py-2 text-left text-xs font-medium uppercase align-middle border">Máq.</th>
                                        <th rowspan="2" class="px-2 py-2 text-left text-xs font-medium uppercase align-middle border">Produto</th>
                                        <th colspan="3" class="px-2 py-2 text-center text-xs font-medium uppercase border">Planejado</th>
                                        <th colspan="3" class="px-2 py-2 text-center text-xs font-medium uppercase border bg-blue-100">1º Turno</th>
                                        <th colspan="3" class="px-2 py-2 text-center text-xs font-medium uppercase border bg-yellow-100">2º Turno</th>
                                        <th colspan="3" class="px-2 py-2 text-center text-xs font-medium uppercase border bg-purple-100">3º Turno</th>
                                        <th rowspan="2" class="px-2 py-2 text-center text-xs font-medium uppercase align-middle border">Qtd. Total</th>
                                        <th rowspan="2" class="px-2 py-2 text-center text-xs font-medium uppercase align-middle border">Máq.</th>
                                        <th rowspan="2" class="px-2 py-2 text-center text-xs font-medium uppercase align-middle border no-print">Ação</th>
                                    </tr>
                                    <tr>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border">Ciclo</th>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border">Cav.</th>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border">Peso Pç.</th>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border bg-blue-100">Ciclo Real</th>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border bg-blue-100">Cav. Real</th>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border bg-blue-100">Qtd.</th>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border bg-yellow-100">Ciclo Real</th>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border bg-yellow-100">Cav. Real</th>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border bg-yellow-100">Qtd.</th>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border bg-purple-100">Ciclo Real</th>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border bg-purple-100">Cav. Real</th>
                                        <th class="px-2 py-2 text-center text-xs font-medium uppercase border bg-purple-100">Qtd.</th>
                                    </tr>
                                </thead>
                                <tbody id="planning-table-body" class="divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- PÁGINA: Lançamento -->
                <div id="lancamento-page" class="page-content hidden">
                    <main class="bg-white p-6 md:p-8 rounded-lg shadow-lg border-t-4 border-primary-blue">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i data-lucide="keyboard" class="text-primary-blue"></i>Painel de Lançamento do Operador</h2>
                        <div id="launch-panel-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
                        <div id="launch-panel-loading" class="text-center py-10"><i data-lucide="loader-2" class="w-12 h-12 animate-spin text-primary-blue mx-auto"></i></div>
                        <div id="launch-panel-no-data" class="text-center py-10 text-gray-500" style="display: none;"><p>Nenhum item planejado para hoje.</p></div>
                    </main>
                </div>
                
                <!-- PÁGINA: Melhoria Contínua -->
                <div id="melhoria-page" class="page-content hidden space-y-6">
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg border-t-4 border-status-error">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i data-lucide="search" class="text-status-error"></i>Nova Análise de Causa Raiz (5 Porquês)</h2>
                        <form id="rca-form" class="space-y-4 pt-4">
                            <div>
                                <label for="rca-problem" class="block text-sm font-medium text-gray-700">Problema Identificado (Ex: Rebarba na H-05)</label>
                                <input type="text" id="rca-problem" required class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div><label for="rca-why1" class="block text-sm font-medium text-gray-700">1. Porquê?</label><input type="text" id="rca-why1" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></div>
                            <div><label for="rca-why2" class="block text-sm font-medium text-gray-700">2. Porquê?</label><input type="text" id="rca-why2" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></div>
                            <div><label for="rca-why3" class="block text-sm font-medium text-gray-700">3. Porquê?</label><input type="text" id="rca-why3" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></div>
                            <div><label for="rca-why4" class="block text-sm font-medium text-gray-700">4. Porquê?</label><input type="text" id="rca-why4" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></div>
                            <div><label for="rca-why5" class="block text-sm font-medium text-gray-700">5. Porquê? (Causa Raiz)</label><input type="text" id="rca-why5" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></div>
                            <div>
                                <label for="rca-action" class="block text-sm font-medium text-gray-700">Plano de Ação Corretiva</label>
                                <textarea id="rca-action" rows="3" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></textarea>
                            </div>
                            <button type="submit" class="w-full bg-primary-blue hover:bg-blue-800 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2"><i data-lucide="save"></i><span>Salvar Análise</span></button>
                        </form>
                    </div>
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i data-lucide="history" class="text-gray-600"></i>Histórico de Análises</h2>
                        <div id="rca-list-container" class="overflow-x-auto pt-4"></div>
                    </div>
                </div>

                <!-- PÁGINA: Parada de Máquina -->
                <div id="parada-page" class="page-content hidden space-y-6">
                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg border-t-4 border-status-warning">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i data-lucide="wrench" class="text-status-warning"></i>Registrar Parada de Máquina</h2>
                        <form id="downtime-form" class="space-y-5 pt-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><label for="downtime-date" class="block text-sm font-medium text-gray-700">Data da Parada</label><input type="date" id="downtime-date" name="date" required class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></div>
                                <div><label for="downtime-machine" class="block text-sm font-medium text-gray-700">Máquina</label><select id="downtime-machine" name="machine" required class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></select></div>
                            </div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div><label for="downtime-start-time" class="block text-sm font-medium text-gray-700">Hora Início</label><input type="time" id="downtime-start-time" name="start_time" required class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></div>
                                <div><label for="downtime-end-time" class="block text-sm font-medium text-gray-700">Hora Fim</label><input type="time" id="downtime-end-time" name="end_time" required class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></div>
                            </div>
                            <div><label for="downtime-reason" class="block text-sm font-medium text-gray-700">Motivo da Parada</label><select id="downtime-reason" name="reason" required class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></select></div>
                            <div><label for="downtime-observations" class="block text-sm font-medium text-gray-700">Observações</label><textarea id="downtime-observations" name="observations" rows="3" class="mt-1 block w-full p-2 border-gray-300 rounded-md shadow-sm"></textarea></div>
                            <button type="submit" id="downtime-submit-button" class="w-full bg-primary-blue hover:bg-blue-800 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2"><i data-lucide="save"></i><span>Salvar Registro de Parada</span></button>
                            <div id="downtime-status-message" class="text-sm font-semibold h-5 text-center"></div>
                        </form>
                    </div>

                    <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg">
                        <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i data-lucide="list" class="text-gray-600"></i>Paradas Registradas no Dia</h2>
                            <input type="date" id="downtime-list-date" class="border-gray-300 rounded-md p-2">
                        </div>
                        <div id="downtime-table-container" class="overflow-x-auto pt-4"></div>
                        <div id="downtime-list-loading" class="text-center py-10" style="display: none;"><i data-lucide="loader-2" class="w-12 h-12 animate-spin text-status-warning mx-auto"></i></div>
                        <div id="downtime-list-no-data" class="text-center py-10 text-gray-500" style="display: none;"><p>Nenhuma parada registrada para a data selecionada.</p></div>
                    </div>
                </div>

                <!-- PÁGINA: Análise -->
                <div id="analise-page" class="page-content hidden space-y-6">
                    <div class="bg-white rounded-lg shadow-lg">
                        <div class="p-6 border-b border-gray-200">
                            <nav class="flex space-x-6">
                                <button class="analysis-tab-btn py-2 px-1 border-b-2 transition-all duration-300 active" data-view="resumo"><i data-lucide="file-bar-chart-2" class="w-4 h-4 mr-2 inline"></i>Resumo da Produção</button>
                                <button class="analysis-tab-btn py-2 px-1 border-b-2 transition-all duration-300" data-view="dashboard"><i data-lucide="layout-dashboard" class="w-4 h-4 mr-2 inline"></i>Dashboard Gráfico</button>
                            </nav>
                        </div>
                        
                        <div id="resumo-view" class="analysis-view p-6">
                            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                                <h2 class="text-2xl font-bold">Relatório Detalhado</h2>
                                <div class="flex items-center gap-4">
                                    <input type="date" id="resumo-date-selector" class="border-gray-300 rounded-md p-2">
                                    <button id="print-report-btn" class="bg-text-dark hover:bg-gray-900 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2"><i data-lucide="printer"></i><span>Imprimir</span></button>
                                </div>
                            </div>
                            <div class="flex items-center rounded-md bg-gray-100 p-1 text-sm self-start mb-4">
                                <button id="report-quant-btn" class="report-toggle-btn px-4 py-2 rounded-md active">Quantitativo</button>
                                <button id="report-effic-btn" class="report-toggle-btn px-4 py-2 rounded-md">Eficiência</button>
                            </div>
                            <div id="resumo-content-container" class="overflow-x-auto"></div>
                            <div id="resumo-loading" class="text-center py-10" style="display: none;"><i data-lucide="loader-2" class="w-12 h-12 animate-spin text-primary-blue"></i></div>
                            <div id="resumo-no-data" class="text-center py-10" style="display: none;"><p>Nenhum dado encontrado.</p></div>
                        </div>

                        <div id="dashboard-view" class="analysis-view p-6 hidden">
                            <div class="mb-6 flex flex-col xl:flex-row items-center justify-between gap-4">
                                <div class="w-full flex flex-col md:flex-row items-center gap-4">
                                    <div class="flex-1 flex items-center gap-2">
                                        <label for="start-date-selector" class="font-semibold">De:</label>
                                        <input type="date" id="start-date-selector" class="w-full border-gray-300 rounded-md p-2">
                                    </div>
                                    <div class="flex-1 flex items-center gap-2">
                                        <label for="end-date-selector" class="font-semibold">Até:</label>
                                        <input type="date" id="end-date-selector" class="w-full border-gray-300 rounded-md p-2">
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button data-range="7" class="date-range-btn px-3 py-2 text-sm bg-gray-200 rounded-md">7 dias</button>
                                        <button data-range="30" class="date-range-btn px-3 py-2 text-sm bg-gray-200 rounded-md">30 dias</button>
                                        <button data-range="month" class="date-range-btn px-3 py-2 text-sm bg-gray-200 rounded-md">Este Mês</button>
                                    </div>
                                </div>
                                <button id="refresh-dashboard-btn" class="w-full xl:w-auto bg-primary-blue hover:bg-blue-800 text-white font-bold p-2 px-6 rounded-lg flex items-center justify-center gap-2"><i data-lucide="search"></i><span>Filtrar</span></button>
                            </div>
                            <div id="dashboard-content" class="space-y-6" style="display: none;">
                                <div class="p-6 rounded-lg">
                                    <h2 class="text-xl font-bold mb-4">Indicadores OEE</h2>
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                        <div class="p-5 rounded-lg shadow-lg flex items-center gap-4 border-l-4 border-accent-2">
                                            <div class="p-3 bg-green-100 rounded-full"><i data-lucide="timer" class="w-7 h-7 text-accent-2"></i></div>
                                            <div><p class="text-sm text-gray-500">Disponibilidade</p><p id="kpi-disponibilidade" class="text-2xl font-bold">...</p></div>
                                        </div>
                                        <div class="p-5 rounded-lg shadow-lg flex items-center gap-4 border-l-4 border-primary-blue">
                                            <div class="p-3 bg-blue-100 rounded-full"><i data-lucide="gauge" class="w-7 h-7 text-primary-blue"></i></div>
                                            <div><p class="text-sm text-gray-500">Performance</p><p id="kpi-performance" class="text-2xl font-bold">...</p></div>
                                        </div>
                                        <div class="p-5 rounded-lg shadow-lg flex items-center gap-4 border-l-4 border-status-warning">
                                            <div class="p-3 bg-yellow-100 rounded-full"><i data-lucide="award" class="w-7 h-7 text-status-warning"></i></div>
                                            <div><p class="text-sm text-gray-500">Qualidade</p><p id="kpi-qualidade" class="text-2xl font-bold">...</p></div>
                                        </div>
                                        <div class="bg-gradient-to-br from-accent-1 to-primary-blue text-white p-5 rounded-lg shadow-xl flex items-center gap-4">
                                            <div class="p-3 bg-white/20 rounded-full"><i data-lucide="star"></i></div>
                                            <div><p class="text-sm">OEE Geral</p><p id="kpi-oee" class="text-2xl font-bold">...</p></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div class="p-6 rounded-lg shadow-lg relative">
                                        <div class="flex justify-between items-center mb-4">
                                            <h2 class="text-xl font-bold">Análise Gráfica</h2>
                                            <div class="flex items-center rounded-md bg-gray-100 p-1 text-sm">
                                                <button id="chart-toggle-prod" class="chart-toggle-btn px-3 py-1 rounded-md active">Produção</button>
                                                <button id="chart-toggle-oee" class="chart-toggle-btn px-3 py-1 rounded-md">Eficiência</button>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2 mb-4">
                                            <label for="graph-machine-filter" class="font-semibold text-sm">Máquina:</label>
                                            <select id="graph-machine-filter" class="w-full border-gray-300 rounded-md p-2 text-sm"></select>
                                        </div>
                                        <div id="production-chart-container" class="relative h-72">
                                            <canvas id="productionTimelineChart"></canvas>
                                        </div>
                                        <div id="oee-chart-container" class="relative h-72 hidden">
                                            <canvas id="oeeByShiftChart"></canvas>
                                        </div>
                                        <div id="timeline-chart-message" class="hidden absolute inset-0 items-center justify-center text-gray-500">
                                            <p>Selecione uma máquina para ver os gráficos.</p>
                                        </div>
                                    </div>
                                    <div class="p-6 rounded-lg shadow-lg relative">
                                        <h2 class="text-xl font-bold mb-4">Principais Motivos de Refugo</h2>
                                        <canvas id="paretoChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div id="dashboard-loading" class="text-center py-10" style="display: none;">
                                <i data-lucide="loader-2" class="w-12 h-12 animate-spin text-primary-blue"></i>
                                <p class="mt-4">A carregar dados...</p>
                            </div>
                            <div id="dashboard-error" class="text-center py-10 bg-red-50 rounded-lg" style="display: none;">
                                <i data-lucide="alert-triangle" class="w-12 h-12 text-status-error mx-auto"></i>
                                <p class="mt-4 font-semibold text-red-700">Não foi possível carregar os dados.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Overlay for mobile menu -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden"></div>

    <!-- Modais -->
    <div id="leader-entry-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-40 flex justify-center items-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg m-4">
            <div class="flex justify-between items-center border-b pb-3 mb-5">
                <h3 id="leader-modal-title" class="text-xl font-bold"></h3>
                <button id="leader-modal-close-btn" class="p-1 rounded-full hover:bg-gray-200"><i data-lucide="x"></i></button>
            </div>
            <form id="leader-entry-form"></form>
        </div>
    </div>

    <div id="production-entry-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-40 flex justify-center items-start p-4 overflow-y-auto">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg m-4 mt-10">
            <div class="flex justify-between items-center border-b pb-3 mb-5">
                <h3 id="production-modal-title" class="text-xl font-bold"></h3>
                <button id="production-modal-close-btn" class="p-1 rounded-full hover:bg-gray-200"><i data-lucide="x"></i></button>
            </div>
            <form id="production-entry-form" class="space-y-4">
                <input type="hidden" id="production-entry-plan-id" name="planId">
                <input type="hidden" id="production-entry-turno" name="turno">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="production-entry-full-boxes" class="block text-sm font-medium">Qtd. Caixas Fechadas</label>
                        <input type="number" id="production-entry-full-boxes" name="full_boxes" min="0" value="0" class="mt-1 w-full p-2 border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label for="production-entry-parcial-kg" class="block text-sm font-medium">Peso Parcial Bruto (kg)</label>
                        <input type="number" id="production-entry-parcial-kg" name="parcial_kg" min="0" step="0.01" value="0" class="mt-1 w-full p-2 border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label for="production-entry-box-weight" class="block text-sm font-medium">Peso Caixa (kg)</label>
                        <input type="number" id="production-entry-box-weight" class="mt-1 w-full p-2 border-gray-300 rounded-md bg-gray-100 cursor-not-allowed" readonly>
                    </div>
                </div>
                <div class="hidden">
                    <label for="production-entry-parada" class="block text-sm font-medium">Tempo de Parada (min)</label>
                    <input type="number" id="production-entry-parada" name="duracao_min" min="0" value="0" class="mt-1 w-full p-2 border-gray-300 rounded-md">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="production-entry-refugo" class="block text-sm font-medium">Refugo (kg)</label>
                        <input type="number" id="production-entry-refugo" name="refugo" min="0" step="0.01" value="0" class="mt-1 w-full p-2 border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label for="production-entry-borras" class="block text-sm font-medium">Peso das Borras (kg)</label>
                        <input type="number" id="production-entry-borras" name="borras" min="0" step="0.01" value="0" class="mt-1 w-full p-2 border-gray-300 rounded-md">
                    </div>
                </div>
                <div>
                    <label for="production-entry-perdas" class="block text-sm font-medium">Motivo do Refugo</label>
                    <select id="production-entry-perdas" name="perdas" class="mt-1 w-full p-2 border-gray-300 rounded-md"></select>
                </div>
                <div class="mt-6 flex justify-end gap-3 pt-4 border-t">
                    <button type="button" id="production-modal-cancel-btn" class="bg-gray-200 hover:bg-gray-300 font-bold py-2 px-6 rounded-lg">Cancelar</button>
                    <button type="submit" id="production-modal-save-btn" class="bg-primary-blue hover:bg-blue-800 text-white font-bold py-2 px-6 rounded-lg">Salvar Lançamento</button>
                </div>
                <div id="production-modal-status" class="text-sm font-semibold h-5 text-center mt-2"></div>
            </form>
        </div>
    </div>

    <div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4">
         <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-sm m-4 text-center">
             <div class="flex justify-center mb-4">
                 <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                     <i data-lucide="alert-triangle" class="w-8 h-8 text-status-error"></i>
                 </div>
             </div>
             <h3 class="text-lg font-bold">Confirmar Exclusão</h3>
             <p id="confirm-modal-text" class="text-sm text-gray-600 my-2">Tem a certeza de que deseja excluir este item? Esta ação não pode ser desfeita.</p>
             <div class="mt-6 flex justify-center gap-3">
                 <button id="confirm-modal-cancel-btn" class="bg-gray-200 hover:bg-gray-300 text-text-dark font-bold py-2 px-4 rounded-lg">Cancelar</button>
                 <button id="confirm-modal-ok-btn" class="bg-status-error hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">Excluir</button>
             </div>
         </div>
    </div>

    <script src="database.js"></script>
    <script src="script.js"></script>
</body>
</html>

